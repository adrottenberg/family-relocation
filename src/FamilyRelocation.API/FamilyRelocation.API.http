@baseUrl = https://localhost:7267

# Variables - Update these for testing
@testEmail = your-email@example.com
@testPassword = YourPassword123!
@newPassword = NewPassword123!

### Login
# Returns tokens on success, or a challenge if password change required
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "password": "{{testPassword}}"
}

### Respond to Challenge (NEW_PASSWORD_REQUIRED)
# Use after login returns a challenge - update session from login response
# The 'responses' field uses abstracted field names:
#   - newPassword: for NEW_PASSWORD_REQUIRED
#   - mfaCode: for SMS_MFA
#   - totpCode: for SOFTWARE_TOKEN_MFA
@challengeSession = paste-session-from-login-response
POST {{baseUrl}}/api/auth/respond-to-challenge
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "challengeName": "NEW_PASSWORD_REQUIRED",
    "session": "{{challengeSession}}",
    "responses": {
        "newPassword": "{{newPassword}}"
    }
}

### Respond to Challenge (SMS_MFA)
# Example for SMS MFA challenge
@mfaCode = 123456
POST {{baseUrl}}/api/auth/respond-to-challenge
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "challengeName": "SMS_MFA",
    "session": "{{challengeSession}}",
    "responses": {
        "mfaCode": "{{mfaCode}}"
    }
}

### Refresh Token
# Use the Cognito username (sub/UUID) from the idToken, not email
@cognitoUsername = paste-sub-from-id-token
@refreshToken = paste-refresh-token-here
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
    "username": "{{cognitoUsername}}",
    "refreshToken": "{{refreshToken}}"
}

### Forgot Password
# Sends password reset code to email
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
    "email": "{{testEmail}}"
}

### Confirm Forgot Password
# Complete password reset with code from email
@resetCode = 123456
POST {{baseUrl}}/api/auth/confirm-forgot-password
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "code": "{{resetCode}}",
    "newPassword": "{{newPassword}}"
}

### Resend Confirmation Code
# Resend email verification code for unverified accounts
POST {{baseUrl}}/api/auth/resend-confirmation
Content-Type: application/json

{
    "email": "{{testEmail}}"
}

### Confirm Email
# Verify email with confirmation code
@confirmationCode = 123456
POST {{baseUrl}}/api/auth/confirm-email
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "code": "{{confirmationCode}}"
}

###############################################################################
# APPLICANTS API
###############################################################################

# Variables for Applicants
@accessToken = paste-access-token-from-login
@applicantId = paste-applicant-id-here

### Create Applicant (Anonymous - no auth required)
# Creates a new applicant for board approval
POST {{baseUrl}}/api/applicants
Content-Type: application/json

{
    "husband": {
        "firstName": "Moshe",
        "lastName": "Cohen",
        "fatherName": "Yaakov",
        "email": "moshe@example.com",
        "phoneNumbers": [
            {
                "number": "2015551234",
                "type": "Mobile",
                "isPrimary": true
            }
        ],
        "occupation": "Software Engineer",
        "employerName": "Tech Corp"
    },
    "wife": {
        "firstName": "Sarah",
        "maidenName": "Goldstein",
        "fatherName": "Avraham",
        "email": "sarah@example.com",
        "phoneNumbers": [
            {
                "number": "2015555678",
                "type": "Mobile",
                "isPrimary": true
            }
        ],
        "occupation": "Teacher",
        "employerName": "Bais Yaakov",
        "highSchool": "Bais Yaakov of Brooklyn"
    },
    "address": {
        "street": "123 Main St",
        "street2": "Apt 4B",
        "city": "Brooklyn",
        "state": "NY",
        "zipCode": "11230"
    },
    "children": [
        {
            "age": 8,
            "gender": "Male",
            "name": "Yosef",
            "school": "Torah Academy"
        },
        {
            "age": 5,
            "gender": "Female",
            "name": "Rivka",
            "school": "Bais Yaakov"
        }
    ],
    "currentKehila": "Flatbush",
    "shabbosShul": "Young Israel"
}

### Create Applicant (Minimal - husband only)
POST {{baseUrl}}/api/applicants
Content-Type: application/json

{
    "husband": {
        "firstName": "David",
        "lastName": "Levy"
    }
}

### Get Applicant by ID (Requires Authentication)
GET {{baseUrl}}/api/applicants/{{applicantId}}
Authorization: Bearer {{accessToken}}
