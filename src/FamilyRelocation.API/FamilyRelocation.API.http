@baseUrl = https://localhost:7267

# Variables - Update these for testing
@testEmail = your-email@example.com
@testPassword = YourPassword123!
@newPassword = NewPassword123!

### Login
# Returns tokens on success, or a challenge if password change required
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "password": "{{testPassword}}"
}

### Respond to Challenge (NEW_PASSWORD_REQUIRED)
# Use after login returns a challenge - update session from login response
# The 'responses' field uses abstracted field names:
#   - newPassword: for NEW_PASSWORD_REQUIRED
#   - mfaCode: for SMS_MFA
#   - totpCode: for SOFTWARE_TOKEN_MFA
@challengeSession = paste-session-from-login-response
POST {{baseUrl}}/api/auth/respond-to-challenge
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "challengeName": "NEW_PASSWORD_REQUIRED",
    "session": "{{challengeSession}}",
    "responses": {
        "newPassword": "{{newPassword}}"
    }
}

### Respond to Challenge (SMS_MFA)
# Example for SMS MFA challenge
@mfaCode = 123456
POST {{baseUrl}}/api/auth/respond-to-challenge
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "challengeName": "SMS_MFA",
    "session": "{{challengeSession}}",
    "responses": {
        "mfaCode": "{{mfaCode}}"
    }
}

### Refresh Token
# Use the Cognito username (sub/UUID) from the idToken, not email
@cognitoUsername = paste-sub-from-id-token
@refreshToken = paste-refresh-token-here
POST {{baseUrl}}/api/auth/refresh
Content-Type: application/json

{
    "username": "{{cognitoUsername}}",
    "refreshToken": "{{refreshToken}}"
}

### Forgot Password
# Sends password reset code to email
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: application/json

{
    "email": "{{testEmail}}"
}

### Confirm Forgot Password
# Complete password reset with code from email
@resetCode = 123456
POST {{baseUrl}}/api/auth/confirm-forgot-password
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "code": "{{resetCode}}",
    "newPassword": "{{newPassword}}"
}

### Resend Confirmation Code
# Resend email verification code for unverified accounts
POST {{baseUrl}}/api/auth/resend-confirmation
Content-Type: application/json

{
    "email": "{{testEmail}}"
}

### Confirm Email
# Verify email with confirmation code
@confirmationCode = 123456
POST {{baseUrl}}/api/auth/confirm-email
Content-Type: application/json

{
    "email": "{{testEmail}}",
    "code": "{{confirmationCode}}"
}

###############################################################################
# APPLICANTS API
###############################################################################

# Variables for Applicants
@accessToken = paste-access-token-from-login
@applicantId = paste-applicant-id-here

### Create Applicant (Anonymous - no auth required)
# Creates a new applicant AND a HousingSearch for board approval
# Response includes both applicantId and housingSearchId
POST {{baseUrl}}/api/applicants
Content-Type: application/json

{
    "husband": {
        "firstName": "Moshe",
        "lastName": "Cohen",
        "fatherName": "Yaakov",
        "email": "moshe@example.com",
        "phoneNumbers": [
            {
                "number": "2015551234",
                "type": "Mobile",
                "isPrimary": true
            }
        ],
        "occupation": "Software Engineer",
        "employerName": "Tech Corp"
    },
    "wife": {
        "firstName": "Sarah",
        "maidenName": "Goldstein",
        "fatherName": "Avraham",
        "email": "sarah@example.com",
        "phoneNumbers": [
            {
                "number": "2015555678",
                "type": "Mobile",
                "isPrimary": true
            }
        ],
        "occupation": "Teacher",
        "employerName": "Bais Yaakov",
        "highSchool": "Bais Yaakov of Brooklyn"
    },
    "address": {
        "street": "123 Main St",
        "street2": "Apt 4B",
        "city": "Brooklyn",
        "state": "NY",
        "zipCode": "11230"
    },
    "children": [
        {
            "age": 8,
            "gender": "Male",
            "name": "Yosef",
            "school": "Torah Academy"
        },
        {
            "age": 5,
            "gender": "Female",
            "name": "Rivka",
            "school": "Bais Yaakov"
        }
    ],
    "currentKehila": "Flatbush",
    "shabbosShul": "Young Israel",
    "housingPreferences": {
        "budgetAmount": 550000,
        "minBedrooms": 4,
        "minBathrooms": 2.5,
        "requiredFeatures": ["basement", "garage", "yard"],
        "moveTimeline": "ShortTerm",
        "shulProximity": {
            "maxWalkingDistanceMiles": 0.5,
            "anyShulAcceptable": true
        }
    }
}

### Create Applicant (Minimal - husband only)
# HousingSearch still created with default preferences
POST {{baseUrl}}/api/applicants
Content-Type: application/json

{
    "husband": {
        "firstName": "David",
        "lastName": "Levy"
    }
}

### List Applicants (Requires Authentication)
# Returns paginated list with search, filter, and sort options
GET {{baseUrl}}/api/applicants?page=1&pageSize=20
Authorization: Bearer {{accessToken}}

### List Applicants with Search
GET {{baseUrl}}/api/applicants?search=Cohen
Authorization: Bearer {{accessToken}}

### List Applicants with Filters
# Filter by board decision: Pending, Approved, Rejected, Deferred
# Filter by city
# Filter by date range
GET {{baseUrl}}/api/applicants?boardDecision=Pending&city=Brooklyn&sortBy=familyName&sortOrder=asc
Authorization: Bearer {{accessToken}}

### List Applicants by Stage (for Pipeline/Kanban)
# Filter by housing search stage: Submitted, HouseHunting, UnderContract, Closed, Paused, Rejected
# The frontend can call this once per stage to build the Kanban board
GET {{baseUrl}}/api/applicants?stage=Submitted
Authorization: Bearer {{accessToken}}

### List Applicants by Stage - House Hunting
GET {{baseUrl}}/api/applicants?stage=HouseHunting
Authorization: Bearer {{accessToken}}

### List Applicants by Stage - Under Contract
GET {{baseUrl}}/api/applicants?stage=UnderContract
Authorization: Bearer {{accessToken}}

### Get Applicant by ID (Requires Authentication)
GET {{baseUrl}}/api/applicants/{{applicantId}}
Authorization: Bearer {{accessToken}}

### Update Applicant (Requires Authentication)
PUT {{baseUrl}}/api/applicants/{{applicantId}}
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
    "husband": {
        "firstName": "Moshe",
        "lastName": "Cohen",
        "fatherName": "Yaakov",
        "email": "moshe.updated@example.com",
        "phoneNumbers": [
            {
                "number": "2015551234",
                "type": "Mobile",
                "isPrimary": true
            },
            {
                "number": "2015559999",
                "type": "Home",
                "isPrimary": false
            }
        ],
        "occupation": "Senior Software Engineer",
        "employerName": "Tech Corp Inc"
    },
    "wife": {
        "firstName": "Sarah",
        "maidenName": "Goldstein",
        "fatherName": "Avraham",
        "email": "sarah.updated@example.com",
        "phoneNumbers": [
            {
                "number": "2015555678",
                "type": "Mobile",
                "isPrimary": true
            }
        ],
        "occupation": "Principal",
        "employerName": "Bais Yaakov",
        "highSchool": "Bais Yaakov of Brooklyn"
    },
    "address": {
        "street": "456 Oak Ave",
        "street2": null,
        "city": "Union",
        "state": "NJ",
        "zipCode": "07083"
    },
    "children": [
        {
            "age": 9,
            "gender": "Male",
            "name": "Yosef",
            "school": "Torah Academy"
        },
        {
            "age": 6,
            "gender": "Female",
            "name": "Rivka",
            "school": "Bais Yaakov"
        },
        {
            "age": 2,
            "gender": "Male",
            "name": "Dovid",
            "school": null
        }
    ],
    "currentKehila": "Union",
    "shabbosShul": "Congregation Israel"
}
